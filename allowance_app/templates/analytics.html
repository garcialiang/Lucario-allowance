<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Financial Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <div class="d-flex align-items-center">
            <img src="{{ url_for('static', filename='profile.jpg') }}" 
                 class="rounded-circle border border-2 border-white me-2"
                 style="width: 40px; height: 40px; object-fit: cover;">
            <span class="navbar-brand mb-0">Analytics & Patterns</span>
        </div>
        <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">Back to Dashboard</a>
    </div>
</nav>

<div class="container">
    <div class="row">
        
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header fw-bold">Where is the money going?</div>
                <div class="card-body">
                    {% if spent > 0 %}
                        <canvas id="categoryChart"></canvas>
                    {% else %}
                        <p class="text-center text-muted mt-5">No spending records yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header fw-bold">Earning vs. Spending</div>
                <div class="card-body">
                    <canvas id="summaryChart"></canvas>
                </div>
            </div>
        </div>

    </div>
    
    <div class="alert alert-info text-center">
        <strong>Net Savings:</strong> ${{ "%.2f"|format(earned - spent) }} 
        (You have saved {{ "%.0f"|format((earned - spent) / earned * 100) if earned > 0 else 0 }}% of your income!)
    </div>
</div>

<script>
    // --- 1. PREPARE DATA FROM PYTHON ---
    const spendingData = {{ spending_data|tojson }};
    const totalEarned = {{ earned }};
    const totalSpent = {{ spent }};

    // --- 2. DRAW PIE CHART (Categories) ---
    if (totalSpent > 0) {
        const ctxPie = document.getElementById('categoryChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'doughnut', // 'pie' or 'doughnut'
            data: {
                labels: Object.keys(spendingData),
                datasets: [{
                    data: Object.values(spendingData),
                    backgroundColor: [
                        '#FF6384', // Red
                        '#36A2EB', // Blue
                        '#FFCE56', // Yellow
                        '#4BC0C0', // Teal
                        '#9966FF', // Purple
                        '#FF9F40'  // Orange
                    ]
                }]
            },
            options: { responsive: true }
        });
    }

    // --- 3. DRAW BAR CHART (In vs Out) ---
    const ctxBar = document.getElementById('summaryChart').getContext('2d');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: ['Total Earned', 'Total Spent'],
            datasets: [{
                label: 'Amount ($)',
                data: [totalEarned, totalSpent],
                backgroundColor: ['#28a745', '#dc3545'], // Green for Earn, Red for Spend
                borderRadius: 5
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            },
            plugins: { legend: { display: false } }
        }
    });
</script>

</body>
</html>